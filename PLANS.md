# PLANS.md: Side-Scrolling Shooter（Gradius-like）開発計画

## Purpose / Big Picture

横スクロールのシューティングゲームを実装する。プレイヤーは飛行機を操作し、敵機を撃破してスコア（撃破数）を稼ぐ。被弾でライフゲージが減少し、0でゲームオーバー。敵撃破でドロップするアイテムにより、回復や火力強化、速度強化などの成長要素を提供する。ステージ背景は月面から始まり、宇宙空間を経て複数の惑星へ遷移し、旅をしている感を演出する。

## Non-Goals

- オンラインランキング、マルチプレイの実装
- 複雑な物理演算（重力、空気抵抗など）
- 3D表現

## Core Requirements

### プレイヤー

- 機体種類: 4種（プロペラ、ジェット、戦闘機、UFO）
- ライフゲージ: 被弾で減少、回復アイテムで増加、0でゲームオーバー
- 移動: 2D平面（上下左右）、画面外に出ない制限
- 無敵時間: 被弾直後に短時間の無敵フレーム（連続被弾防止）

### 攻撃

- 攻撃種: 砲弾、追撃ミサイル、投下爆弾、レーザービーム
- 攻撃レベル: アイテムでレベルアップし、威力や弾数、発射間隔などが強化される

### 敵

- 撃破数をカウント（基本スコア）
- 行動パターン: 直進、波状、突進、停止して射撃、編隊など
- 撃破時に確率でアイテムをドロップ

### アイテム

- ライフ回復
- 攻撃レベルアップ（武器種ごと or 共通）
- スピードアップ（上限あり）
- 取得演出: 取得音、アイコン消失、HUD変化

### ステージと背景

- スクロール背景: 月面 → 宇宙空間 → 複数惑星
- ステージ進行: 距離（時間）で区間遷移、背景テーマと敵テーブルを切り替える
- 演出: パララックス（前景と遠景の速度差）、星屑、惑星シルエットなど

## System Design

### シーン構成

- TitleScene: 機体選択、操作説明、開始
- GameScene: メインゲーム（プレイヤー、敵、弾、アイテム、背景、HUD）
- GameOverScene: 結果表示（撃破数）、リトライ、タイトルへ戻る
- OptionScene（任意）: 音量、キー設定など

### エンティティ設計（概念）

- Player
- Enemy（複数タイプ、AIパターン差し替え）
- Projectile（弾種ごとに派生、またはデータ駆動）
- Item（回復、強化、速度など）
- BackgroundLayer（複数レイヤ）
- HUD（ライフバー、撃破数、武器レベル、機体種）

### ゲームループ

- update(): 入力処理 → 生成/AI → 移動 → 衝突判定 → ダメージ/回復 → 破棄 → スコア更新 → ステージ管理
- draw(): 背景 → エンティティ → エフェクト → HUD

### 衝突判定

- AABB（矩形）を基本とし、当たり判定サイズをスプライトより小さく調整して理不尽さを軽減
- レーザーは線分 or 細長矩形として判定

### 難易度カーブ

- ステージ距離に応じたスポーン頻度増加
- 敵HP、弾速、弾幕密度を段階調整
- プレイヤー強化が進む前提で後半の圧を上げる

## Data-Driven（設定ファイル方針）

以下は外部設定化して、ゲームバランス調整をコード変更なしで回せるようにする。

- 機体別パラメータ（速度、当たり判定、初期ライフ、武器初期状態）
- 武器別パラメータ（威力、連射、弾速、追尾性能、爆風半径など）
- アイテム効果量（回復量、レベル上昇、速度上昇）
- 敵スポーンテーブル（区間ごとの敵種、頻度、編隊、ボス有無）
- ステージ区間（背景テーマ、遷移距離、演出）

## File / Module Layout（案）

- PLANS.md
- src/
- main.py（エントリポイント）
- core/
- game.py（ゲーム全体制御）
- scene_base.py
- input.py
- math2d.py（ベクトル、AABBなど）
- rng.py
- scenes/
- title_scene.py
- game_scene.py
- game_over_scene.py
- entities/
- player.py
- enemy.py
- projectile.py
- item.py
- effects.py
- systems/
- spawner.py（敵スポーン）
- collision.py
- stage.py（区間遷移、背景切替）
- drop_table.py
- ui/
- hud.py
- assets/
- images/（スプライト、背景タイル等）
- sounds/
- config/
- game.toml（上記パラメータ群）

## Milestones

### M1: 基本プレイ成立

- タイトル → ゲーム → ゲームオーバー遷移
- プレイヤー移動、砲弾発射、敵直進、衝突でダメージ
- 撃破数カウント、HUD表示、ライフゲージ

### M2: 武器追加と成長

- 追撃ミサイル、投下爆弾、レーザー追加
- 攻撃レベルアップ実装（武器ごと or 共通方針を確定）
- アイテムドロップと取得効果

### M3: ステージ旅情と敵バリエーション

- 月面 → 宇宙 → 惑星1 → 惑星2…の区間遷移
- パララックス背景、演出強化
- 敵パターン増、編隊導入、ミニボス（任意）

### M4: バランス調整と仕上げ

- 難易度カーブ調整、当たり判定の最適化
- 効果音、被弾演出、爆発エフェクト
- リトライ導線と操作説明の改善

## Decision Log

- 機体4種の差別化方針
  - プロペラ: 低速だが取り回し良い、初期ライフ多め
  - ジェット: 速度高い、弾速優位
  - 戦闘機: 火力伸びやすい、ミサイル強化が得意
  - UFO: ヒットボックス小さめ、レーザーに特化
- 攻撃レベルアップの粒度
  - 案A: 「現在選択武器のみ」強化
  - 案B: 「武器スロット共通」強化
  - 早期は案Bで実装を簡素化し、調整で案Aに寄せる余地を残す

## Risks / Unknowns

- 武器が増えるほど衝突判定と描画負荷が上がる
  - 対策: オブジェクトプール、画面外破棄、同時弾数上限
- 難易度が単調になりやすい
  - 対策: 区間ごとに敵の主役を変える、編隊と地形的圧（疑似）で緩急を作る
- UFOの強みが他機体と被る可能性
  - 対策: レーザー運用と回避性能で差別化、代わりに最大ライフを抑える

## Acceptance Criteria

- 4種類の機体を選べて、少なくとも体感として性能差がある
- ライフゲージが正しく減り、0でゲームオーバーになる
- 4種以上の攻撃が実装され、アイテムで強化できる
- 敵撃破数が正しくカウントされ、結果画面で表示される
- 背景が月面から始まり、宇宙を経て複数惑星へ遷移する

## Progress

- リポジトリ雛形作成、シーン遷移の骨格
- Player移動と砲弾発射
- Enemy直進と撃破、撃破数カウント
- 被弾とライフゲージ、無敵時間
- アイテムドロップ、回復と強化
- 追加武器3種
- ステージ区間と背景遷移
- 敵パターン増加とバランス調整

## Outcomes & Retrospective（リリース後に記入）

- 何がうまくいったか
- 何が詰まったか
- 次回作るなら変える点（武器仕様、難易度設計、背景制作フローなど）

